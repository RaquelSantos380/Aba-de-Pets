<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <audio id="backgroundMusic" src="music.mp3" loop></audio>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let score = 0;
        let life = 5; // Começando com 5 de vida
        let items = [];
        let enemies = [];
        let rapHealth = 25; // Saúde da Raposa
        let gameOver = false;
        let mouseX = canvas.width / 2;
        let mouseY = canvas.height / 2;

        const character = {
            x: canvas.width / 2 - 25,
            y: canvas.height / 2 - 25,
            width: 50,
            height: 50,
            img: new Image()
        };
        character.img.src = 'girl.png'; // Imagem da personagem

        let showRap = false;
        let rapX = Math.random() * canvas.width;
        let rapY = Math.random() * canvas.height;
        let rapHitCount = 0; // Contador de cliques para derrotar a Raposa
        let fairyX = Math.random() * canvas.width; // Posição da fada
        let fairyY = Math.random() * canvas.height; // Posição da fada
        let fairyVisible = false; // Fada visível

        const backgroundImages = [new Image(), new Image()];
        backgroundImages[0].src = 'cen1.jpg'; // Imagem do cenário 1
        backgroundImages[1].src = 'cen2.jpg'; // Imagem do cenário 2
        let currentBackground = 0; // Controla qual cenário está sendo exibido

        function drawBackground() {
            ctx.drawImage(backgroundImages[currentBackground], 0, 0, canvas.width, canvas.height);
        }

        function drawCharacter() {
            ctx.drawImage(character.img, character.x, character.y, character.width, character.height);
        }

        class Item {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.width = 30;
                this.height = 30;
                this.collected = false; // Marca se o item foi coletado
            }
            draw() {
                if (!this.collected) {
                    const img = new Image();
                    img.src = this.type;
                    ctx.drawImage(img, this.x, this.y, this.width, this.height);
                }
            }
            update() {
                // Não se move em direção ao mouse
            }
        }

        class Enemy {
            constructor(x, y, type, damage) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.width = 30;
                this.height = 30;
                this.speed = 2; // Velocidade dos inimigos
                this.damage = damage;
                this.health = 1; // Inimigos normais têm 1 de vida
            }
            update() {
                const dx = mouseX - this.x;
                const dy = mouseY - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance > 0) {
                    this.x += (dx / distance) * this.speed;
                    this.y += (dy / distance) * this.speed;
                }
            }
            draw() {
                const img = new Image();
                img.src = this.type;
                ctx.drawImage(img, this.x, this.y, this.width, this.height);
            }
        }

        function spawnItems() {
            items.push(new Item(Math.random() * canvas.width, Math.random() * canvas.height, 'Bis.png'));
            items.push(new Item(Math.random() * canvas.width, Math.random() * canvas.height, 'Bisc.png'));
            items.push(new Item(Math.random() * canvas.width, Math.random() * canvas.height, 'Pud.png'));
        }

        function spawnEnemies() {
            const enemyTypes = [
                { type: 'Gato.png', damage: 1 },
                { type: 'Mos.png', damage: 1 },
                { type: 'Bat.png', damage: 1 },
                { type: 'rap.png', damage: 2 } // Raposa como inimigo
            ];
            const randomEnemy = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
            const enemy = new Enemy(Math.random() * canvas.width, Math.random() * canvas.height, randomEnemy.type, randomEnemy.damage);
            enemies.push(enemy);
        }

        function update() {
            drawBackground(); // Desenha o fundo

            if (!gameOver) {
                items.forEach(item => {
                    item.draw();
                    if (!item.collected && mouseX > item.x && mouseX < item.x + item.width && mouseY > item.y && mouseY < item.y + item.height) {
                        if (item.type === 'fada.png') {
                            life += 2; // Adiciona 2 vidas ao coletar a fada
                            item.collected = true;
                        } else {
                            score += 1;
                            item.collected = true; // Marca o item como coletado
                        }
                    }
                });

                enemies.forEach((enemy, index) => {
                    enemy.update();
                    enemy.draw();
                    if (mouseX > enemy.x && mouseX < enemy.x + enemy.width && mouseY > enemy.y && mouseY < enemy.y + enemy.height) {
                        life -= enemy.damage; // Diminui a vida do jogador
                        enemies.splice(index, 1); // Remove o inimigo
                    }
                });

                // Lógica para a Raposa
                if (score >= 30) {
                    showRap = true;
                }

                if (showRap && rapHealth > 0) {
                    const rapImage = new Image();
                    rapImage.src = 'rap.png'; // Imagem da Raposa
                    ctx.drawImage(rapImage, rapX, rapY, 200, 200);

                    // Mover a Raposa em direção ao mouse
                    const dx = mouseX - rapX;
                    const dy = mouseY - rapY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance > 0) {
                        rapX += (dx / distance) * 2; // Velocidade da Raposa
                        rapY += (dy / distance) * 2; // Velocidade da Raposa
                    }
                }

                // Verifica se a fada deve aparecer
                if (fairyVisible) {
                    const fairyImage = new Image();
                    fairyImage.src = 'fada.png'; // Imagem da Fada
                    ctx.drawImage(fairyImage, fairyX, fairyY, 50, 50);
                    if (mouseX > fairyX && mouseX < fairyX + 50 && mouseY > fairyY && mouseY < fairyY + 50) {
                        life += 2; // Adiciona 2 vidas ao coletar a fada
                        fairyVisible = false; // Esconde a fada após coletar
                    }
                }

                // Exibir pontuação e vida centralizadas
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText(`Score: ${score}`, canvas.width / 2 - 50, 20);
                ctx.fillText(`Life: ${life}`, canvas.width / 2 + 50, 20);
                if (showRap) {
                    ctx.fillText(`Rap Health: ${rapHealth}`, canvas.width / 2 - 50, 40);
                }

                drawCharacter();
                
                // Diminui o tamanho do personagem e aumenta o dano dos inimigos a cada 50 pontos
                if (score >= 50) {
                    character.width = 40;
                    character.height = 40;
                    enemies.forEach(enemy => {
                        enemy.damage += 10; // Aumenta o dano dos inimigos
                    });
                }

                // Verifica se o jogador perdeu
                if (life <= 0) {
                    gameOver = true;
                }
            } else {
                ctx.fillStyle = 'red';
                ctx.font = '40px Arial';
                ctx.fillText('Você perdeu', canvas.width / 2 - 100, canvas.height / 2);
                ctx.font = '20px Arial';
                ctx.fillText('Clique para Reiniciar', canvas.width / 2 - 100, canvas.height / 2 + 40);
            }
        }

        function gameLoop() {
            if (!gameOver) {
                update();
                requestAnimationFrame(gameLoop);
            }
        }

        canvas.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            character.x = mouseX - character.width / 2;
            character.y = mouseY - character.height / 2;
        });

        canvas.addEventListener('click', () => {
            if (gameOver) {
                // Reinicia o jogo
                score = 0;
                life = 5;
                enemies = [];
                rapHealth = 25;
                gameOver = false;
                character.width = 50; // Reseta o tamanho do personagem
                character.height = 50;
                rapX = Math.random() * canvas.width;
                rapY = Math.random() * canvas.height;
                fairyVisible = false; // Esconde a fada
            } else if (showRap && rapHealth > 0) {
                rapHitCount++;
                if (rapHitCount >= 2) {
                    rapHealth -= 20;
                    rapHitCount = 0; // Reseta o contador
                }
            }
        });

        setInterval(spawnItems, 3000);
        setInterval(spawnEnemies, 5000); // Inimigos a cada 5 segundos

        // Aumentar a velocidade e fazer a fada aparecer a cada 10 segundos
        let speedIncreaseInterval = setInterval(() => {
            enemies.forEach(enemy => enemy.speed += 1); // Aumenta a velocidade dos inimigos
            fairyVisible = true; // Torna a fada visível
            fairyX = Math.random() * canvas.width; // Nova posição da fada
            fairyY = Math.random() * canvas.height; // Nova posição da fada
        }, 10000);

        document.getElementById('backgroundMusic').play();

        gameLoop();
    </script>
</body>
</html>
